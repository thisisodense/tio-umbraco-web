<div class="umb-dialog" ng-controller="Concorde.DeployDialogController">
    <div class="umb-pane">
        <ul class="deployModal unstyled" ng-switch="step">

            <li ng-switch-default>
                <div ng-if="deployment">
                    <h5>Deploy {{nodeName}} from {{environment.source}} to {{environment.destination}}</h5>
                    <p>
                        Should all pages below {{nodeName}} be included in the deploy, or is it only
                        "<em>{{nodeName}}</em>" you want
                        to deploy to {{environment.destination}}?
                    </p>
                    <hr/>
                    <label>
                        <input type="checkbox" ng-model="deployment.includeDescendants"/>
                        Include all pages below "<em>{{nodeName}}</em>"
                    </label>
                    <button prevent-default class="btn btn-primary" ng-click="queue(deployment, true)">Deploy</button>
                </div>
            </li>

            <li ng-switch-when="current-queue">
                <h5>Your deployment queue</h5>
                <div ng-repeat="provider in manifest.Providers">
                    <p><strong>{{providerName(provider.Id).name}}</strong>
                    </p>
                    <ul class="unstyled">
                        <li ng-if="provider.IncludeAll">
                            <i class="icon-check"></i> Including all items
                        </li>
                        <li ng-repeat="entry in provider.Items">
                            <i class="icon-check"></i> {{entry.Name}} <br/>
                            <small class="smallwith" ng-if="entry.IncludeChildren"> including descendants</small>
                        </li>
                    </ul>
                </div>
                <button class="btn" ng-click="package()" prevent-default>Deploy queue</button>
                <a href class="btn btn-link" ng-click="clear()">Clear</a>
            </li>

            <li ng-switch-when="working">
                <h5>{{currentTask.description}}</h5>
                <div class="progress progress-deploy">
                    <div class="bar" style="width: { {(currentTask.done /currentTask.total)* 100}}% ; "></div>
                </div>
                <small>{{currentTask.currentActivity}}</small>
                <hr/>
            </li>

            <li ng-switch-when="pre-collect">
                <h5>Getting your content ready to be deployed</h5>
                <p>
                    We will collect all your changes, and all the things they need to function properly, then we will
                    compare these changes with {{environment.destination}} - so we ensure only new content will be deployed
                </p>
                <div class="progress progress-deploy">
                    <div class="bar" style="width: { {(currentTask.done /currentTask.total)* 100}}% ; "></div>
                </div>
                <small>{{currentTask.currentActivity}}</small>
            </li>

            <li class="deployOutput deployList deployError" ng-switch-when="problems">
                <deploy-problems>
                    <div ng-repeat="provider in manifest.notAllowed">
                        <p><strong>{{provider.name}}</strong>
                        </p>
                        <ul class="deployProblems">
                            <li ng-repeat="item in provider.items">
                                {{item.name}} is out of sync<br/>
                                <ul ng-if="item.issues">
                                    <li ng-repeat="issue in item.issues">
                                        <span ng-show="issue.title">
                                        {{issue.title}}
                                        <small>{{issue.description}}</small>
                                    </span>
                                        <span ng-hide="issue.title">
                                        {{issue.property}} has been changed
                                        <small>The field '{{issue.property}}' has a different value on the remote website</small>
                                    </span>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </deploy-problems>
                <button prevent-default class="btn btn-primary" ng-click="package(deployment)">Retry</button>
            </li>

            <li class="deployOutput deployList deployError" ng-switch-when="errors">
                <deploy-problems>
                    <ul class="deployProblems">
                        <li ng-repeat="error in errors">{{error}}</li>
                    </ul>
                </deploy-problems>
                <button prevent-default class="btn btn-primary" ng-click="package(deployment)">Retry</button>
            </li>

            <li ng-switch-when="empty">
                <h5>No new changes</h5>
                <p>Everything is up to date, so no need to deploy</p>
                <button ng-if="!onDashboard" class="btn" prevent-default ng-click="nav.hideDialog()">Ok</button>
            </li>

            <li ng-switch-when="empty-queue">
                <h5>Your deployment queue</h5>
                <p>The queue is currently empty, everything has been deployed already - to add new items to the queue right click content in the tree on the left and select "queue for deployment"</p>
                <button prevent-default class="btn btn-primary" ng-click="reloadQueue()">Reload queue</button>
            </li>

            <li class="deployOutput deployError" ng-switch-when="exception">
                <h5>Something went wrong :(</h5>
                <p>An error occurred while transferring the selected content, so the deployment could not finish.</p>
                <p>If you are an editor then please contact your developers or admins with the technical details listed below for help in resolving the issue.</p>
                <br/>
                <p>Developers can refer to this documentation for further assistance: <a href="https://our.umbraco.org/documentation/Umbraco-as-a-Service/Troubleshooting/Content-Deploy-Error/" target="_blank">Troubleshooting deploy errors</a>
                </p>
                <br/>
                <a href="#" prevent-default show-details="#details-view">Click to expand the technical details below to see exactly what went wrong</a>
                <div class="hide" id="details-view">
                    <h4>Details:</h4>
                    <p>Here is some technical information that might help shed some light on whats happened:</p>
                    <p class="text-error"><strong>Message:&nbsp;</strong><small>{{error.message}}</small>
                    </p>
                    <p><strong>Exception Message:&nbsp;</strong><small>{{error.exceptionMessage}}</small>
                    </p>
                    <p><strong>Exception Type:&nbsp;</strong><small>{{error.type}}</small>
                    </p>
                    <p><strong>Stack Trace:&nbsp;</strong><small>{{error.stackTrace}}</small>
                    </p>
                    <pre>{{currentTask | json}}</pre>
                </div>
                <br/>
                <button ng-if="!onDashboard" class="btn" prevent-default ng-click="nav.hideDialog()">Close</button>
                <button ng-if="onDashboard" prevent-default class="btn btn-primary" ng-click="reloadQueue()">Reload queue</button>
            </li>

            <li class="deployOutput deployList" ng-switch-when="collect">
                <h5>Ready to deploy to {{environment.destination}}</h5>
                <p>
                    The following components need to be deployed along with {{nodeName}} for everything to function
                    properly, this can be due to dependencies, references and the structure of your website.
                </p>
                <hr/>
                <div ng-repeat="(key, value) in manifest.deployment">
                    <p><strong>{{providerName(key).name}}</strong>
                    </p>
                    <ul class="deployItems">
                        <li ng-repeat="item in value">
                            {{item.Name}}
                        </li>
                    </ul>
                </div>
                <button class="btn btn-primary" prevent-default ng-click="deploy()">Deploy everything now</button>
                <br/>
                <small>This will deploy {{manifest.deployement.length}} items to the website at {{environment.url}} </small>
            </li>

            <li ng-switch-when="deploy">
                <h5>Deploying...</h5>
                <p>Please hang on as changes are collected and deployed to {{environment.destination}}</p>
                <div class="progress progress-deploy">
                    <div class="bar" style="width: { {(currentTask.done /currentTask.total)* 100}}% ; "></div>
                </div>
                <small>{{currentTask.currentActivity}}</small>
            </li>

            <li class="deployOutput deployDone" ng-switch-when="done">
                <h5>Deployment complete</h5>
                <p>
                    Everything was packaged and sent to the website at
                    <a target="_blank" href="{{environment.url}}">{{environment.url}}</a>
                </p>
                <button ng-if="!onDashboard" class="btn" prevent-default ng-click="nav.hideDialog()">Okay</button>
                <button ng-if="onDashboard" class="btn" prevent-default ng-click="clear()">Okay</button>
            </li>

            <li class="deployOutput deployDone" ng-switch-when="restored">
                <h5>Restore complete</h5>
                <p>
                    Umbraco has downloaded the lates content and media, and restored all the underlying components of the
                    website. All types, templates and other dependencies have been updated in this process.
                </p>
                <button ng-if="!onDashboard" class="btn" prevent-default ng-click="nav.hideDialog()">Okay</button>
                <button ng-if="onDashboard" class="btn" prevent-default ng-click="clear()">Okay</button>
            </li>

        </ul>
    </div>
</div>